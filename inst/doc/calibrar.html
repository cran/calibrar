<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Ricardo Oliveros-Ramos" />

<meta name="date" content="2024-02-14" />

<title>Getting started with the calibrar package</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Getting started with the
<code>calibrar</code> package</h1>
<h4 class="author">Ricardo Oliveros-Ramos</h4>
<h4 class="date">2024-02-14</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This package allows the parameter estimation (i.e. calibration) of
complex models, including stochastic ones. It implements generic
functions that can be used for fitting any type of models, especially
those with non-differentiable objective functions, with the same syntax
as <code>base::optim</code>. It supports multiple phases estimation
(sequential parameter masking), constrained optimization (bounding box
restrictions) and automatic parallel computation of numerical gradients.
Some common maximum likelihood estimation methods and automated
construction of the objective function from simulated model outputs is
provided.</p>
</div>
<div id="basic-usage" class="section level2">
<h2>Basic usage</h2>
<p>This vignette covers the basic usage of the package, introducing the
functions <code>optim2()</code>, <code>optimh()</code> and
<code>calibrate()</code>.</p>
<div id="optim2" class="section level3">
<h3>optim2()</h3>
<p>As the name sugests, <code>optim2()</code> is intended to extend the
functionality of <code>stats::optim()</code> and it uses the same
arguments (with some additions):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">optim2</span>(</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  par,</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  fn,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="at">gr =</span> <span class="cn">NULL</span>,</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  ...,</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;Nelder-Mead&quot;</span>, <span class="st">&quot;BFGS&quot;</span>, <span class="st">&quot;CG&quot;</span>, <span class="st">&quot;L-BFGS-B&quot;</span>, <span class="st">&quot;SANN&quot;</span>, <span class="st">&quot;Brent&quot;</span>, <span class="st">&quot;nlm&quot;</span>, <span class="st">&quot;nlminb&quot;</span>,</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>    <span class="st">&quot;Rcgmin&quot;</span>, <span class="st">&quot;Rvmmin&quot;</span>, <span class="st">&quot;hjn&quot;</span>, <span class="st">&quot;spg&quot;</span>, <span class="st">&quot;LBFGSB3&quot;</span>, <span class="st">&quot;AHR-ES&quot;</span>),</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="at">lower =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>  <span class="at">upper =</span> <span class="sc">+</span><span class="cn">Inf</span>,</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>  <span class="at">active =</span> <span class="cn">NULL</span>,</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(),</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>  <span class="at">hessian =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  <span class="at">parallel =</span> <span class="cn">FALSE</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>)</span></code></pre></div>
<p>The first difference is the possible values for the
<code>method</code> argument. In addition to the first six methods, also
available in <code>optim()</code>, <code>optim2()</code> gives access to
<code>stats::nlm()</code> and <code>stats::nlminb()</code> but with the
same syntax as <code>optim()</code> to make them easy to use. In
addition, three methods from the <code>optimr</code> package
(<code>Rcgmin</code>, <code>Rvmmin</code>, <code>hjn</code>), the
L-BFGS-B v3 implemented in the <code>bfgsb3c</code> package and the
<code>AHR-ES</code> (Adaptative Hierarchical Recombination Evolutionary
Strategy) implemented in this package.</p>
<p>In the next example, we compare the outputs of <code>optim()</code>
and <code>optim2()</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(calibrar)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">optim</span>(<span class="at">par=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="at">fn=</span><span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt; $par</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt; [1] -1.931714e-04 -3.044063e-04 -1.744066e-04  1.940552e-05  5.641574e-05</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt; $value</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt; [1] 1.639553e-07</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt; $counts</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt; function gradient </span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt;      456       NA </span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#&gt; $convergence</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co">#&gt; $message</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co">#&gt; NULL</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">optim2</span>(<span class="at">par=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="at">fn=</span><span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt; $par</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt; [1] -1.931714e-04 -3.044063e-04 -1.744066e-04  1.940552e-05  5.641574e-05</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt; $value</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt; [1] 1.639553e-07</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; $counts</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; function gradient </span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt;      456       NA </span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt; $convergence</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt; $message</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>The results are identical, as here <code>optim2()</code> acts just as
a wrapper for <code>optim()</code>. Now, we can run the same example
with two other methods:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">optim2</span>(<span class="at">par=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="at">fn=</span><span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">method=</span><span class="st">&quot;nlm&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#&gt; $par</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt; [1] -2.502443e-13 -2.502443e-13 -2.502443e-13 -2.502443e-13 -2.502443e-13</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; $value</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt; [1] 3.13111e-25</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt; $counts</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt; function gradient </span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt;       NA       NA </span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt; $convergence</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt; $message</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Relative gradient is close to zero, current iterate is probably solution.&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">880820</span>) <span class="co"># for reproducibility</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">optim2</span>(<span class="at">par=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="at">fn=</span><span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">method=</span><span class="st">&quot;AHR-ES&quot;</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; $par</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; [1]  3.749723e-10 -2.023475e-10  1.655858e-10 -2.272363e-10  1.488461e-10</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt; $value</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; [1] 2.827589e-19</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; $counts</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; function gradient </span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt;     1024        0 </span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; $convergence</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; $message</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Stopping criteria reached in 128 generations.&quot;</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt; $generations</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">#&gt; [1] 128</span></span></code></pre></div>
<p>The second difference is the new argument <code>active</code>, which
is a vector indicating if a parameters will be optimized (i.e. active)
or fixed to a constant value during the optimization process. In the
next example, we will fix the third and fourth parameters to its initial
values:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">optim2</span>(<span class="at">par=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="at">fn=</span><span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>       <span class="at">active=</span><span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>))</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; Warning in paropt[isActive] &lt;- output$par: número de items para para sustituir</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt; no es un múltiplo de la longitud del reemplazo</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt; $par</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; [1] 1.062264e-05 1.167696e-04 1.000000e+00 1.000000e+00 5.492100e-05</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; $value</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; $counts</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; function gradient </span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt;      202       NA </span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; $convergence</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt; $message</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>As we can see, in the final solution, the <code>par</code> value keep
the values at 1, the initial value provided. All the numerical gradients
computed internally have also ‘masked’ this parameters and the
derivatives are not computed for them to speed up computation time.</p>
<p>Finally, the third difference is the new argument
<code>parallel</code>, that active the parallel computation of the
numerical gradient, when <code>gr</code> is not supplied:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">optim2</span>(<span class="at">par=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="at">fn=</span><span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">parallel=</span><span class="cn">TRUE</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; $par</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; [1] -1.931714e-04 -3.044063e-04 -1.744066e-04  1.940552e-05  5.641574e-05</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; $value</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; [1] 1.639553e-07</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; $counts</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; function gradient </span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt;      456       NA </span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; $convergence</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt; $message</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>This last option will increase performance when the computation time
of <code>fn</code> in considerable. We will explain in detail this
feature in a following section.</p>
<p>Additionally, the method for the computation of the numerical
gradient can be chosen within the <code>control</code> list:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">optim2</span>(<span class="at">par=</span><span class="fu">rep</span>(<span class="fl">0.5</span>, <span class="dv">5</span>), <span class="at">fn=</span><span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="dv">2</span><span class="sc">*</span>x<span class="sc">^</span>(<span class="fl">3.1</span><span class="sc">*</span>x)), <span class="at">control=</span><span class="fu">list</span>(<span class="at">gr.method=</span><span class="st">&quot;richardson&quot;</span>))</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="fu">optim2</span>(<span class="at">par=</span><span class="fu">rep</span>(<span class="fl">0.5</span>, <span class="dv">5</span>), <span class="at">fn=</span><span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="dv">2</span><span class="sc">*</span>x<span class="sc">^</span>(<span class="fl">3.1</span><span class="sc">*</span>x)), <span class="at">control=</span><span class="fu">list</span>(<span class="at">gr.method=</span><span class="st">&quot;central&quot;</span>))</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="fu">optim2</span>(<span class="at">par=</span><span class="fu">rep</span>(<span class="fl">0.5</span>, <span class="dv">5</span>), <span class="at">fn=</span><span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="dv">2</span><span class="sc">*</span>x<span class="sc">^</span>(<span class="fl">3.1</span><span class="sc">*</span>x)), <span class="at">control=</span><span class="fu">list</span>(<span class="at">gr.method=</span><span class="st">&quot;forward&quot;</span>))</span></code></pre></div>
</div>
<div id="optimh" class="section level3">
<h3>optimh()</h3>
<p>The function <code>optimh()</code> has a similar functionality as
<code>optim2()</code> but acts as a wrapper for several heuristic
optimization algorithms implemented in several packages:
<code>dfoptim</code>, <code>optimr</code>, <code>minqa</code>,
<code>cmaes</code>, <code>genSA</code>, <code>DEoptim</code>,
<code>soma</code>, <code>rgenoud</code> and <code>psoptim</code>. The
<code>optimh()</code> function standardizes the inputs and outputs to
those of <code>optim()</code>, providing a more convenient user
interface. All specific arguments of this methods can be passed to the
original function using the <code>control</code> argument.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">optimh</span>(</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  par,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  fn,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="at">gr =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  ...,</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;AHR-ES&quot;</span>, <span class="st">&quot;Nelder-Mead&quot;</span>, <span class="st">&quot;SANN&quot;</span>, <span class="st">&quot;hjn&quot;</span>, <span class="st">&quot;CMA-ES&quot;</span>, <span class="st">&quot;genSA&quot;</span>, <span class="st">&quot;DE&quot;</span>, <span class="st">&quot;soma&quot;</span>,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>    <span class="st">&quot;genoud&quot;</span>, <span class="st">&quot;PSO&quot;</span>, <span class="st">&quot;hybridPSO&quot;</span>, <span class="st">&quot;mads&quot;</span>, <span class="st">&quot;hjk&quot;</span>, <span class="st">&quot;hjkb&quot;</span>, <span class="st">&quot;nmk&quot;</span>, <span class="st">&quot;nmkb&quot;</span>),</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>  <span class="at">lower =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>  <span class="at">upper =</span> <span class="sc">+</span><span class="cn">Inf</span>,</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>  <span class="at">active =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(),</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>  <span class="at">hessian =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>  <span class="at">parallel =</span> <span class="cn">FALSE</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Covariance Matrix Adaptation Evolutionary Strategy</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">880820</span>) <span class="co"># for reproducibility</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="fu">optimh</span>(<span class="at">par=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="at">fn=</span><span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">method=</span><span class="st">&quot;CMA-ES&quot;</span>,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>       <span class="at">control=</span><span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">200</span>))</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt; $par</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; [1] -1.848860e-11  3.646458e-11 -8.209875e-11  2.866646e-11 -8.636439e-11</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; $value</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; [1] 1.669227e-20</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt; $counts</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; function gradient </span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt;     1600       NA </span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#&gt; $convergence</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co">#&gt; $message</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="co">#&gt; NULL</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Generalized Simulated Anneling</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">880820</span>) <span class="co"># for reproducibility</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="fu">optimh</span>(<span class="at">par=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="at">fn=</span><span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">method=</span><span class="st">&quot;genSA&quot;</span>, </span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>       <span class="at">lower=</span><span class="fu">rep</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">5</span>), <span class="at">upper=</span><span class="fu">rep</span>(<span class="dv">100</span>, <span class="dv">5</span>),</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>       <span class="at">control=</span><span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">200</span>, <span class="at">temperature=</span><span class="dv">6000</span>))</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt; $par</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt; [1] 6.988898e-11 6.988898e-11 6.988898e-11 6.988898e-11 6.988898e-11</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt; $value</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt; [1] 2.442235e-20</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt; $counts</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt; function gradient </span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">#&gt;     2024        0 </span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co">#&gt; $convergence</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co">#&gt; $message</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Self-Organising Migrating Algorithm</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">880820</span>) <span class="co"># for reproducibility</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="fu">optimh</span>(<span class="at">par=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="at">fn=</span><span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">method=</span><span class="st">&quot;soma&quot;</span>,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>       <span class="at">lower=</span><span class="fu">rep</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">5</span>), <span class="at">upper=</span><span class="fu">rep</span>(<span class="dv">100</span>, <span class="dv">5</span>),</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>       <span class="at">control=</span><span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">200</span>))</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#&gt; $par</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; [1]  1.519459e-16 -4.704646e-16  8.741813e-17  1.169846e-17 -1.104563e-16</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt; $value</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt; [1] 2.644038e-31</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co">#&gt; $counts</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt; function gradient </span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="co">#&gt;     2000       NA </span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="co">#&gt; $convergence</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="co">#&gt; $message</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span></code></pre></div>
<p>The <code>maxit</code> control argument has been standardized to work
with all methods and to represent the maximum number of iterations of
the algorithm. However, the specific number of function evaluations per
iteration may vary between methods. You can refer to the help pages from
each package to have details about every specific method and its control
arguments.</p>
</div>
<div id="running-in-parallel" class="section level3">
<h3>Running in parallel</h3>
<p>Most algorithms implemented in <code>optim2()</code> and some in
<code>optimh</code> can benefit of parallel computation. For the methods
that uses the numerical computation of the gradient, this will be
calculated in parallel. In order to support any type of parallel
implementation, the parallel setup is NOT automatic, and must be done by
the user previous to executed the optimization, as described in the
following example:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>ncores <span class="ot">=</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span> <span class="co"># number of cores to be used</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>cl <span class="ot">=</span> <span class="fu">makeCluster</span>(ncores)</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co"># this is slower than sequential for very fast models (like this one)</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="fu">optim2</span>(<span class="at">par=</span><span class="fu">rep</span>(<span class="fl">0.5</span>, <span class="dv">5</span>), <span class="at">fn=</span><span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>               <span class="at">control=</span><span class="fu">list</span>(<span class="at">ncores=</span>ncores), <span class="at">parallel=</span><span class="cn">TRUE</span>)</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="fu">stopCluster</span>(cl) <span class="co"># close the parallel connections</span></span></code></pre></div>
</div>
</div>
<div id="sequential-parameter-estimation" class="section level2">
<h2>Sequential parameter estimation</h2>
<div id="calibrate" class="section level3">
<h3>calibrate()</h3>
<p>The <code>calibrate()</code> function implements an automatic
sequential parameter estimation, meaning parameters can be un-masked
(set active) progressively during sequential phases of the calibration
process.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">calibrate</span>(</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  par,</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  fn,</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="at">gr =</span> <span class="cn">NULL</span>,</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  ...,</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  <span class="at">method =</span> <span class="cn">NULL</span>,</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>  <span class="at">lower =</span> <span class="cn">NULL</span>,</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>  <span class="at">upper =</span> <span class="cn">NULL</span>,</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>  <span class="at">phases =</span> <span class="cn">NULL</span>,</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(),</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>  <span class="at">hessian =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>  <span class="at">replicates =</span> <span class="dv">1</span>,</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>  <span class="at">parallel =</span> <span class="cn">FALSE</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>)</span></code></pre></div>
<p>With the basic syntax, the <code>calibrate()</code> function will
work similarly to <code>optim2()</code> and <code>optimh()</code>,
performing a simple optimization:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">calibrate</span>(<span class="at">par=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="cn">NA</span>,<span class="cn">NA</span>), <span class="at">fn=</span><span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">#&gt; Using optimization method &#39;Rvmmin&#39;.</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#&gt; Elapsed time: 0.00s</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt; Function value: 1.24979e-16</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt; Parameter values: -5e-09 -5e-09 -5e-09 -5e-09 -5e-09</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt; Status: Rvmminu appears to have converged</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt; Optimization using &#39;Rvmmin&#39; algorithm.</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">#&gt; Function value: 1.249787e-16 </span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co">#&gt; Status: Rvmminu appears to have converged </span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co">#&gt; Parameters:</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="co">#&gt; [1] -4.999645e-09 -4.999291e-09 -4.998935e-09 -5.000000e-09 -5.000000e-09</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="co">#&gt; Computation:</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="co">#&gt; function gradient </span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="co">#&gt;       10        6</span></span></code></pre></div>
<p>If <code>upper</code> and <code>lower</code> bounds are provided, the
calibrate function can take <code>NA</code> as starting values for the
optimization, to some or all of the parameters:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">calibrate</span>(<span class="at">par=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="cn">NA</span>,<span class="dv">5</span>), <span class="at">fn=</span><span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>          <span class="at">lower=</span><span class="fu">rep</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">5</span>), <span class="at">upper=</span><span class="fu">rep</span>(<span class="dv">100</span>, <span class="dv">5</span>))</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co">#&gt; Using optimization method &#39;Rvmmin&#39;.</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#&gt; Elapsed time: 0.00s</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#&gt; Function value: 1.23526e-16</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt; Parameter values: -4.98e-09 -4.97e-09 -4.96e-09 -5e-09 -4.94e-09</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt; Status: Rvmminb appears to have converged</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt; Optimization using &#39;Rvmmin&#39; algorithm.</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#&gt; Function value: 1.235263e-16 </span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">#&gt; Status: Rvmminb appears to have converged </span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co">#&gt; Parameters:</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="co">#&gt; [1] -4.982589e-09 -4.974351e-09 -4.960025e-09 -4.999959e-09 -4.935026e-09</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="co">#&gt; Computation:</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="co">#&gt; function gradient </span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="co">#&gt;       13        5</span></span></code></pre></div>
</div>
<div id="setting-up-a-parameter-estimation-with-multiple-phases." class="section level3">
<h3>Setting up a parameter estimation with multiple phases.</h3>
<p>Multiple <code>phases</code> can be set up by selecting a different
one for each parameter. The starting value of the optimization for each
phase is updated with the best parameters found in the previous
phase:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">calibrate</span>(<span class="at">par=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="cn">NA</span>,<span class="dv">5</span>), <span class="at">fn=</span><span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>          <span class="at">lower=</span><span class="fu">rep</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">5</span>), <span class="at">upper=</span><span class="fu">rep</span>(<span class="dv">100</span>, <span class="dv">5</span>),</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>          <span class="at">phases=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co">#&gt; Parameter estimation in three phases.</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="co">#&gt; - Phase 1: 2 of 5 parameters active.</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co">#&gt;  Using optimization method &#39;Rvmmin&#39;.</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="co">#&gt;  Phase 1 finished (0.00s)</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="co">#&gt;  Function value: 13</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co">#&gt;  Parameter values: -2.97e-08 -2.61e-08</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="co">#&gt; - Phase 2: 4 of 5 parameters active.</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="co">#&gt;  Using optimization method &#39;Rvmmin&#39;.</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="co">#&gt;  Phase 2 finished (0.00s)</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="co">#&gt;  Function value: 9</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="co">#&gt;  Parameter values: 5.84e-09 -3.93e-08 0 9.41e-09</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a><span class="co">#&gt; - Phase 3: 5 of 5 parameters active.</span></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a><span class="co">#&gt;  Using optimization method &#39;Rvmmin&#39;.</span></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a><span class="co">#&gt;  Phase 3 finished (0.00s)</span></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a><span class="co">#&gt;  Function value: 1.24997e-16</span></span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a><span class="co">#&gt;  Parameter values: -5e-09 -5e-09 -5e-09 -5e-09 -5e-09</span></span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a><span class="co">#&gt; Status: Rvmminb appears to have converged</span></span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a><span class="co">#&gt; Optimization using &#39;Rvmmin&#39; algorithm.</span></span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a><span class="co">#&gt; Function value: 1.24997e-16 </span></span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a><span class="co">#&gt; Status: Rvmminb appears to have converged </span></span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a><span class="co">#&gt; Parameters:</span></span>
<span id="cb17-29"><a href="#cb17-29" tabindex="-1"></a><span class="co">#&gt; [1] -5.000004e-09 -5.000078e-09 -4.999605e-09 -5.000002e-09 -5.000006e-09</span></span>
<span id="cb17-30"><a href="#cb17-30" tabindex="-1"></a><span class="co">#&gt; Computation:</span></span>
<span id="cb17-31"><a href="#cb17-31" tabindex="-1"></a><span class="co">#&gt; function gradient </span></span>
<span id="cb17-32"><a href="#cb17-32" tabindex="-1"></a><span class="co">#&gt;       11        6</span></span></code></pre></div>
<p>When a phase is set to a negative number, the parameter is fixed at
its initial value during all the calibration and it is never
optimized:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">calibrate</span>(<span class="at">par=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="cn">NA</span>,<span class="dv">5</span>), <span class="at">fn=</span><span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>          <span class="at">lower=</span><span class="fu">rep</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">5</span>), <span class="at">upper=</span><span class="fu">rep</span>(<span class="dv">100</span>, <span class="dv">5</span>),</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>          <span class="at">phases=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="co">#&gt; Parameter estimation in two phases.</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="co">#&gt; - Phase 1: 2 of 5 parameters active.</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="co">#&gt;  Using optimization method &#39;Rvmmin&#39;.</span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="co">#&gt;  Phase 1 finished (0.00s)</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="co">#&gt;  Function value: 13</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="co">#&gt;  Parameter values: -2.97e-08 -2.61e-08</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a><span class="co">#&gt; - Phase 2: 4 of 5 parameters active.</span></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a><span class="co">#&gt;  Using optimization method &#39;Rvmmin&#39;.</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a><span class="co">#&gt;  Phase 2 finished (0.00s)</span></span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a><span class="co">#&gt;  Function value: 9</span></span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a><span class="co">#&gt;  Parameter values: 5.84e-09 -3.93e-08 0 9.41e-09</span></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a><span class="co">#&gt; Status: Rvmminb appears to have converged</span></span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a><span class="co">#&gt; Optimization using &#39;Rvmmin&#39; algorithm.</span></span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a><span class="co">#&gt; Function value: 9 </span></span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a><span class="co">#&gt; Status: Rvmminb appears to have converged </span></span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a><span class="co">#&gt; Parameters:</span></span>
<span id="cb18-23"><a href="#cb18-23" tabindex="-1"></a><span class="co">#&gt; [1]  5.835174e-09 -3.934291e-08  3.000000e+00  0.000000e+00  9.410321e-09</span></span>
<span id="cb18-24"><a href="#cb18-24" tabindex="-1"></a><span class="co">#&gt; * Some parameters are not calibrated.</span></span>
<span id="cb18-25"><a href="#cb18-25" tabindex="-1"></a><span class="co">#&gt; Computation:</span></span>
<span id="cb18-26"><a href="#cb18-26" tabindex="-1"></a><span class="co">#&gt; function gradient </span></span>
<span id="cb18-27"><a href="#cb18-27" tabindex="-1"></a><span class="co">#&gt;        6        4</span></span></code></pre></div>
</div>
<div id="dealing-with-stochastic-functions" class="section level3">
<h3>Dealing with stochastic functions</h3>
<p>When dealing with stochastic functions, the argument
<code>replicates</code> can be helpful, as it allows to evaluate the
objective function several times, taking the average value of them as
the actual function value (as an approximation of the expected value of
the function). When <code>replicates=1</code>, the algorithm used by
default is “LBFGSB3”, but when replicates is greater than 1, “AHR-ES” is
used. The next examples use the function <code>sphereN()</code>, which
computes the Euclidean distance from a point <code>x</code> to the
origin of coordinates after a random displacement of its position (see
<code>?sphereN</code> for details). We will set the maximum number of
iterations to 1000 to speed up the execution of the vignette.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">calibrate</span>(<span class="at">par=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="cn">NA</span>,<span class="dv">5</span>), <span class="at">fn=</span>sphereN,</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>          <span class="at">lower=</span><span class="fu">rep</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">5</span>), <span class="at">upper=</span><span class="fu">rep</span>(<span class="dv">100</span>, <span class="dv">5</span>),</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>          <span class="at">phases=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">replicates=</span><span class="dv">3</span>, <span class="at">control=</span><span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">1000</span>))</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co">#&gt; Parameter estimation in three phases.</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co">#&gt; - Phase 1: 2 of 5 parameters active.</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">#&gt;  Using optimization method &#39;AHR-ES&#39;.</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co">#&gt;  Phase 1 finished (0.80s)</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co">#&gt;  Function value: 12.9126</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co">#&gt;  Parameter values: -0.324 0.12</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="co">#&gt; - Phase 2: 4 of 5 parameters active.</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="co">#&gt;  Using optimization method &#39;AHR-ES&#39;.</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="co">#&gt;  Phase 2 finished (0.90s)</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a><span class="co">#&gt;  Function value: 10.1169</span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a><span class="co">#&gt;  Parameter values: 0.0695 0.112 0.151 -0.0849</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a><span class="co">#&gt; - Phase 3: 5 of 5 parameters active.</span></span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a><span class="co">#&gt;  Using optimization method &#39;AHR-ES&#39;.</span></span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a><span class="co">#&gt;  Phase 3 finished (0.91s)</span></span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a><span class="co">#&gt;  Function value: 0.0534613</span></span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a><span class="co">#&gt;  Parameter values: -0.00843 0.0767 0.0606 0.0265 0.0048</span></span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a><span class="co">#&gt; Status: Maximum number of generations or function evaluations reached.</span></span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a><span class="co">#&gt; Optimization using &#39;AHR-ES&#39; algorithm.</span></span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a><span class="co">#&gt; Function value: 0.05346132 </span></span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a><span class="co">#&gt; Status: Maximum number of generations or function evaluations reached. </span></span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a><span class="co">#&gt; Parameters:</span></span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a><span class="co">#&gt; [1] -0.008425148  0.076711662  0.060580990  0.026532747  0.004796660</span></span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a><span class="co">#&gt; Computation: (1000 generations)</span></span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a><span class="co">#&gt; function gradient </span></span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a><span class="co">#&gt;     8000        0</span></span></code></pre></div>
<p>The number of replicates can be one single value or a vector with the
length equal to the number of phases:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">calibrate</span>(<span class="at">par=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="cn">NA</span>,<span class="dv">5</span>), <span class="at">fn=</span>sphereN,</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>          <span class="at">lower=</span><span class="fu">rep</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">5</span>), <span class="at">upper=</span><span class="fu">rep</span>(<span class="dv">100</span>, <span class="dv">5</span>),</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>          <span class="at">phases=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">replicates=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">5</span>), <span class="at">control=</span><span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">1000</span>))</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="co">#&gt; Parameter estimation in three phases.</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co">#&gt; - Phase 1: 2 of 5 parameters active.</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="co">#&gt;  Using optimization method &#39;AHR-ES&#39;.</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="co">#&gt;  Phase 1 finished (0.67s)</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="co">#&gt;  Function value: 13.3163</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="co">#&gt;  Parameter values: -0.346 -0.101</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a><span class="co">#&gt; - Phase 2: 4 of 5 parameters active.</span></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a><span class="co">#&gt;  Using optimization method &#39;AHR-ES&#39;.</span></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a><span class="co">#&gt;  Phase 2 finished (0.73s)</span></span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a><span class="co">#&gt;  Function value: 9.8584</span></span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a><span class="co">#&gt;  Parameter values: 0.217 -0.335 0.24 0.101</span></span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a><span class="co">#&gt; - Phase 3: 5 of 5 parameters active.</span></span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a><span class="co">#&gt;  Using optimization method &#39;AHR-ES&#39;.</span></span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a><span class="co">#&gt;  Phase 3 finished (1.16s)</span></span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a><span class="co">#&gt;  Function value: 0.0412229</span></span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a><span class="co">#&gt;  Parameter values: 0.0282 0.00574 -0.0127 -0.0375 -0.0192</span></span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a><span class="co">#&gt; Status: Maximum number of generations or function evaluations reached.</span></span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a><span class="co">#&gt; Optimization using &#39;AHR-ES&#39; algorithm.</span></span>
<span id="cb20-26"><a href="#cb20-26" tabindex="-1"></a><span class="co">#&gt; Function value: 0.04122286 </span></span>
<span id="cb20-27"><a href="#cb20-27" tabindex="-1"></a><span class="co">#&gt; Status: Maximum number of generations or function evaluations reached. </span></span>
<span id="cb20-28"><a href="#cb20-28" tabindex="-1"></a><span class="co">#&gt; Parameters:</span></span>
<span id="cb20-29"><a href="#cb20-29" tabindex="-1"></a><span class="co">#&gt; [1]  0.028236432  0.005735164 -0.012675352 -0.037462605 -0.019210042</span></span>
<span id="cb20-30"><a href="#cb20-30" tabindex="-1"></a><span class="co">#&gt; Computation: (1000 generations)</span></span>
<span id="cb20-31"><a href="#cb20-31" tabindex="-1"></a><span class="co">#&gt; function gradient </span></span>
<span id="cb20-32"><a href="#cb20-32" tabindex="-1"></a><span class="co">#&gt;     8000        0</span></span></code></pre></div>
</div>
<div id="parameters-as-lists" class="section level3">
<h3>Parameters as lists</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">calibrate</span>(<span class="at">par=</span><span class="fu">list</span>(<span class="at">par1=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">par2=</span><span class="cn">NA</span>, <span class="at">par3=</span><span class="dv">5</span>), <span class="at">fn=</span>sphereN,</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>          <span class="at">lower=</span><span class="fu">rep</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">5</span>), <span class="at">upper=</span><span class="fu">rep</span>(<span class="dv">100</span>, <span class="dv">5</span>),</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>          <span class="at">phases=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">replicates=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>), <span class="at">control=</span><span class="fu">list</span>(<span class="at">maxit=</span><span class="dv">1000</span>))</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="co">#&gt; Parameter estimation in two phases.</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a><span class="co">#&gt; - Phase 1: 2 of 5 parameters active.</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a><span class="co">#&gt;  Using optimization method &#39;AHR-ES&#39;.</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="co">#&gt;  Phase 1 finished (0.90s)</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a><span class="co">#&gt;  Function value: 13.1182</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="co">#&gt;  Parameter values: 0.0558 0.181</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a><span class="co">#&gt; - Phase 2: 4 of 5 parameters active.</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a><span class="co">#&gt;  Using optimization method &#39;AHR-ES&#39;.</span></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a><span class="co">#&gt;  Phase 2 finished (1.65s)</span></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a><span class="co">#&gt;  Function value: 8.96767</span></span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a><span class="co">#&gt;  Parameter values: -0.0167 0.164 -0.14 0.0335</span></span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a><span class="co">#&gt; Status: Maximum number of generations or function evaluations reached.</span></span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a><span class="co">#&gt; Optimization using &#39;AHR-ES&#39; algorithm.</span></span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a><span class="co">#&gt; Function value: 8.96767 </span></span>
<span id="cb21-21"><a href="#cb21-21" tabindex="-1"></a><span class="co">#&gt; Status: Maximum number of generations or function evaluations reached. </span></span>
<span id="cb21-22"><a href="#cb21-22" tabindex="-1"></a><span class="co">#&gt; Parameters:</span></span>
<span id="cb21-23"><a href="#cb21-23" tabindex="-1"></a><span class="co">#&gt;       par11       par12       par13        par2        par3 </span></span>
<span id="cb21-24"><a href="#cb21-24" tabindex="-1"></a><span class="co">#&gt; -0.01674863  0.16445070  3.00000000 -0.13951818  0.03351795 </span></span>
<span id="cb21-25"><a href="#cb21-25" tabindex="-1"></a><span class="co">#&gt; * Some parameters are not calibrated.</span></span>
<span id="cb21-26"><a href="#cb21-26" tabindex="-1"></a><span class="co">#&gt; Computation: (1000 generations)</span></span>
<span id="cb21-27"><a href="#cb21-27" tabindex="-1"></a><span class="co">#&gt; function gradient </span></span>
<span id="cb21-28"><a href="#cb21-28" tabindex="-1"></a><span class="co">#&gt;     8000        0</span></span></code></pre></div>
<p>Note that the function <code>fn</code> must be able to take a list as
parameter set, and the user must ensure this works beforehand.</p>
</div>
<div id="running-in-parallel-1" class="section level3">
<h3>Running in parallel</h3>
<p>Most algorithms implemented in the <code>calibrate</code> function
can benefit of parallel computation. For the methods that uses the
numerical computation of the gradient, this will be calculated in
parallel as in <code>optim2()</code>. In order to support any type of
parallel implementation, the parallel setup is NOT automatic, and must
be done by the user previous to executed the optimization, as described
in the following example:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>ncores <span class="ot">=</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span> <span class="co"># number of cores to be used</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>cl <span class="ot">=</span> <span class="fu">makeCluster</span>(ncores)</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="co"># this is slower than sequential for very fast models (like this one)</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>calib <span class="ot">=</span> <span class="fu">calibrate</span>(<span class="at">par=</span><span class="fu">rep</span>(<span class="fl">0.5</span>, <span class="dv">5</span>), <span class="at">fn=</span>sphereN,</span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>                  <span class="at">replicates=</span><span class="dv">3</span>, </span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>                  <span class="at">lower=</span><span class="fu">rep</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>), </span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a>                  <span class="at">upper=</span><span class="fu">rep</span>(<span class="sc">+</span><span class="dv">5</span>, <span class="dv">5</span>), </span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a>                  <span class="at">phases=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), </span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a>                  <span class="at">control=</span><span class="fu">list</span>(<span class="at">parallel=</span><span class="cn">TRUE</span>, <span class="at">ncores=</span>ncores))</span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a><span class="fu">stopCluster</span>(cl) <span class="co"># close the parallel connections</span></span></code></pre></div>
<p>Please, refer to <code>vignette(package=&quot;calibrar&quot;)</code> for
additional vignettes or to the <a href="https://roliveros-ramos.github.io/calibrar/">calibrar website</a>
for more details.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
